---
layout: post
title: Docker å…¥é–€å¯¦ä½œ
description: Docker çš„ Slogan å°±æ˜¯å¿«é€Ÿçš„ build ship runã€‚è€Œå…¶ä¸­ building å’Œ shipping å¤§æ¦‚æ˜¯æœ€èŠ±æ™‚é–“çš„æ­¥é©Ÿäº†ï¼ç‚ºä»€éº¼æ˜æ˜ä¸€å€‹ç°¡å–®çš„ Image å»æœ‰ 500MB çš„å¤§å°å‘¢å‘¢ï¼Ÿä»Šå¤©å°±ä¾†çœ‹çœ‹å‰µå»ºä¸€å€‹å„ªè³ª Docker Image çš„å„ç¨®æ–¹æ³•ã€‚
series: Container Technology
image:
  src: /blog/container-docker/02/hero.png
  alt: hero
head:
  meta:
    - name: keywords
      content: container, docker, tech, cloud
    - name: robots
      content: index, follow
    - name: author
      content: å°è²“è²“å·¥ç¨‹å¸«
    - name: authorImage
      content: /common/siliconvalleykittycatengineer.jpeg
    - name: date
      content: Jan 27, 2021
    - name: read
      content: 9 min read
    - property: og:site_name
      content: çŸ½è°·è·¯ä¸Šé‡è¦‹ä½ 
    - property: og:type
      content: article
    - property: og:title
      content: Docker å…¥é–€å¯¦ä½œ
    - property: og:description
      content: Docker çš„ Slogan å°±æ˜¯å¿«é€Ÿçš„ build ship runã€‚è€Œå…¶ä¸­ building å’Œ shipping å¤§æ¦‚æ˜¯æœ€èŠ±æ™‚é–“çš„æ­¥é©Ÿäº†ï¼ç‚ºä»€éº¼æ˜æ˜ä¸€å€‹ç°¡å–®çš„ Image å»æœ‰ 500MB çš„å¤§å°å‘¢å‘¢ï¼Ÿä»Šå¤©å°±ä¾†çœ‹çœ‹å‰µå»ºä¸€å€‹å„ªè³ª Docker Image çš„å„ç¨®æ–¹æ³•ã€‚
    - property: og:url
      content: https://blog.ewocker.com/blog/container-docker-02
    - property: og:image
      content: https://blog.ewocker.com/blog/container-docker/02/hero.png
    - property: article:published_time
      content: 2021-01-27T00:00:00.000Z
    - property: article:modified_time
      content: 2023-03-20T00:00:00.000Z
    - property: article:publisher
      content: https://www.facebook.com/SiliconValleyKittyCatEngineer
    - property: article:author
      content: https://www.facebook.com/SiliconValleyKittyCatEngineer
    - property: og:image:height
      content: 536
    - property: og:image:width
      content: 750
    - name: twitter:card
      content: summary_large_image
    - name: twitter:title
      content: Docker å…¥é–€å¯¦ä½œ
    - name: twitter:description
      content: Docker çš„ Slogan å°±æ˜¯å¿«é€Ÿçš„ build ship runã€‚è€Œå…¶ä¸­ building å’Œ shipping å¤§æ¦‚æ˜¯æœ€èŠ±æ™‚é–“çš„æ­¥é©Ÿäº†ï¼ç‚ºä»€éº¼æ˜æ˜ä¸€å€‹ç°¡å–®çš„ Image å»æœ‰ 500MB çš„å¤§å°å‘¢å‘¢ï¼Ÿä»Šå¤©å°±ä¾†çœ‹çœ‹å‰µå»ºä¸€å€‹å„ªè³ª Docker Image çš„å„ç¨®æ–¹æ³•ã€‚
    - name: twitter:url
      content: https://blog.ewocker.com/blog/container-docker-02
    - name: twitter:image
      content: https://blog.ewocker.com/blog/container-docker/02/hero.png
    - name: twitter:label1
      content: Written by
    - name: twitter:data1
      content: å°è²“è²“å·¥ç¨‹å¸«
---

::note
ä»¥ä¸‹æ‰€æœ‰å½±ç‰‡éƒ½æ˜¯ asciinemaï¼Œæ‰€ä»¥ä»»ä½•æŒ‡ä»¤å’Œ output éƒ½å¯ä»¥ç›´æ¥è¤‡è£½ä¸‹ä¾†è²¼åˆ°ä½ è‡ªå·±çš„çµ‚ç«¯æ©Ÿ Terminal ä¸Šã€‚
::

## Docker Image Layers åˆ†å±¤å¼çµæ§‹ - UnionFS

é¦–å…ˆå¿…é ˆå…ˆäº†è§£ Docker å’Œ [UnionFS](https://en.wikipedia.org/wiki/UnionFS?ref=blog.ewocker.com)<sup>\[1\]</sup> çš„é—œä¿‚ã€‚ç°¡è€Œè¨€ä¹‹**æ¯ä¸€å±¤ Layer<sup>\[2\]</sup> åŒ…å«è¨±å¤šæª”æ¡ˆï¼Œè€Œ Docker Image å°±æ˜¯ä¸€å±¤ç–Šä¸€å±¤çš„é›†åˆé«”**ã€‚çœ‹çœ‹ä»¥ä¸‹çš„ç¤ºæ„åœ–ï¼š

![](/blog/container-docker/02/unionfs.png)

ä»¥ä¸Šåœ–ç‚ºä¾‹ï¼ŒImage æœ¬èº«æœ‰ä¸‰å±¤ï¼Œä¸¦ä¸”æ¯å±¤éƒ½æœ‰å„è‡ªçš„æª”æ¡ˆã€‚**ä¸€å€‹å®Œæ•´çš„ Image æœ¬èº«æ‰€æœ‰çš„éšå±¤éƒ½æ˜¯ read-only (åªè®€) çš„ï¼Œä½† Docker æœƒåœ¨ä¸Šé¢åŠ ä¸Šä¸€å€‹ read-write (è®€å¯«çš†å¯) Â çš„ç¬¬å››å±¤**ã€‚å¹¾ä¹ Dockerfile çš„æ¯ä¸€è¡Œéƒ½æœƒå»ºç«‹èµ·ä¸€å±¤ã€‚

::foot-note
\[1\] UnionFS - Union File System  
\[2\] Layer éšå±¤
::

### é¦–å…ˆä¾†è­‰æ˜å‰µå»ºå‡ºçš„å¤§å°æ˜¯å’Œä¸Šé¢æ•˜è¿°çš„ä¸€æ¨£

è€Œäº†è§£åˆ†å±¤å¼çµæ§‹ç‚ºä»€éº¼é‚£éº¼é‡è¦å‘¢ï¼Ÿå‡å¦‚åœ¨ç¤ºæ„åœ–ä¸­çš„ Layer 3 å°‡ Layer 1 çš„ file1 åˆªé™¤ï¼Œé‚£æœ€å¾Œ Image çš„å¤§å°æœƒæ˜¯å¤šå°‘å‘¢ï¼Ÿï¼ˆç­”æ¡ˆæ˜¯ä¸è®Šï¼‰

ç¸½çµå°±æ˜¯å³ä¾¿æˆ‘å€‘åœ¨å¾Œé¢çš„éšå±¤ä¸­åˆªé™¤äº†ä¸€äº›æª”æ¡ˆï¼Œé‚£äº›æª”æ¡ˆä¾ç„¶æœƒç•™åœ¨æˆ‘å€‘çš„åŸå…ˆçš„éšå±¤è£¡é¢ã€‚å› ç‚º Image æ˜¯éšå±¤çš„ç¸½é«”ï¼Œæ‰€ä»¥**å³ä¾¿å¾Œé¢åˆªé™¤äº†ä¹Ÿåªæ˜¯å¤šäº†ä¸€å€‹æ–°çš„éšå±¤è€Œå·²ï¼ŒImage çš„å¤§å°ä¸¦ä¸æœƒæ¸›å°‘**ã€‚

ä»¥æ­¤ç‚ºèµ·é»ï¼Œæ¥ä¸‹ä¾†ä¾†çœ‹çœ‹æœ‰å“ªäº›æ–¹æ³•å¯ä»¥æ¸›å°‘ Image çš„å¤§å°ã€‚

---

## Normalize Image Layers æ¨™æº–åŒ–æ˜ åƒéšå±¤

ä¸€å€‹ Image æœ€å¤šå¯ä»¥æœ‰ 127 å€‹éšå±¤ï¼Œæ ¹æ“šä¸åŒçš„ Storage Drive å¯ä»¥æœ‰æ›´å¤šçš„éšå±¤æ•¸é‡ï¼Œä½†è‹¥æ˜¯æœ‰è¶…éé€™å€‹æ•¸é‡å¯èƒ½æœƒé™åˆ¶ä¸€å€‹ Image å¯ä»¥è¢«å‰µå»ºçš„åœ°æ–¹ (å› ç‚ºä¸æ˜¯æ‰€æœ‰çš„ Storage Drive éƒ½å¯ä»¥)ã€‚

ä¸Šé¢èªªéåœ¨ UnionFS è£¡ï¼Œ**ä»»ä½•åŠ åˆ°éšå±¤è£¡çš„æª”æ¡ˆéƒ½æœƒä¸€ç›´å­˜åœ¨æ–¼é‚£å€‹éšå±¤**ï¼Œå³ä¾¿åœ¨å¾Œçš„éšå±¤è£¡å°‡å…¶åˆªé™¤ `rm` ä¹Ÿä¸€æ¨£ã€‚ä¸‹é¢ä¾†è­‰æ˜ä¸€ä¸‹ï¼š

é€™ç†ä»‹ç´¹ä¸€å€‹å¯¦ç”¨çš„å°å·¥å…· [dive](https://github.com/wagoodman/dive?ref=blog.ewocker.com)ï¼Œç”¨ä¾†æª¢è¦– Image çš„å„ç¨®ç´°é …ã€‚é€™è£¡æˆ‘å€‘ç”¨ä¾†çœ‹çœ‹ Image çš„æ•ˆç‡ efficiencyã€‚

![](/blog/container-docker/02/image.png)

åœ–ä¸­çœ‹åˆ°åˆªé™¤å¾Œçš„æ•ˆç‡å¾ 100% è®Šæˆ 43% è€Œå·²ï¼Œä¸¦ä¸”ç›¸è¼ƒåŸå…ˆ Image æµªè²»äº† 7.3 MB çš„ç©ºé–“ã€‚é‚£æœ‰å“ªäº›æ–¹æ³•èƒ½æ›´å¿«é€Ÿçš„å‰µå»ºå‡ºé«˜æ•ˆçš„ Image å‘¢ï¼Ÿ

### Build Context

```
# Git
.git
.gitignore
.gitattributes
.github

# Docker
Dockerfile
docker-compose.yml
.dockerignore

# Documentation
README.md
CHANGELOG.md
CONTRIBUTING.md
CODE_OF_CONDUCT.md
SECURITY.md

# macOS (optional)
.DS_Store

# Visual Studio Code (optional)
.vscode
```
::image-with-note
å¸¸è¦‹çš„ .dockerignore æª”æ¡ˆ
::

åœ¨å‰µå»º Image æ™‚ï¼Œæœ€å¸¸è¦‹çš„å°±æ˜¯è·‘ `docker build .` ï¼Œé€™æ™‚å‰é¢çš„ `.` æ˜¯åœ¨å‘Šè¨´ docker å°‡ç•¶å‰è·¯å¾‘ç”¨ä½œ root filesystemã€‚é€™ä»£è¡¨åœ¨æ¯ä¸€æ¬¡å‰µå»º Image æ™‚ docker éƒ½å¿…é ˆå…ˆå°‡ç•¶å‰è·¯å¾‘è£¡çš„æ‰€æœ‰è³‡æ–™å’Œæª”æ¡ˆè¼‰å…¥ build contextï¼Œè€ƒæ…®åˆ°å¤šæ•¸äººç¿’æ…£å°‡ Dockerfile æ”¾åœ¨å°ˆæ¡ˆçš„æœ€ä¸Šå±¤ï¼Œé€™å¯èƒ½æ˜¯å¹¾ç™¾ MB ç”šè‡³å¹¾ GB çš„å¤§å°ã€‚èˆ‰ä¾‹ä¾†èªªä¸€å€‹ nodejs çš„å°ˆæ¡ˆä¹Ÿè¨±åªæœ‰ 2MB çš„ code ä½† `node_modules` å»æ˜¯å¥½å¹¾ GB çš„å¤§å°ï¼Œä½†é€™äº›åœ¨å‰µå»º Image æ™‚æ­£å¸¸ä¸¦ä¸æœƒè¢« `COPY`ï¼Œè€Œæ˜¯æœƒåœ¨ Image è£¡é¢é¡å¤–è·‘ `npm install` ï¼Œé€™å°è‡´ docker å¿…é ˆè¦è¼‰å…¥å¤šé¤˜å¹¾ GB çš„è³‡æ–™ã€‚

æ”¹å–„é€™å€‹çš„æ–¹æ³•æœ‰è¨±å¤šç¨®ï¼Œå…¶ä¸€æ˜¯å°‡ Dockerfile æ”¾åœ¨é©åˆçš„è·¯å¾‘ï¼Œè®“å‰µå»º Image æ™‚ä¸æœƒè¼‰å…¥å¤šé¤˜çš„è³‡æ–™ã€‚å†ä¾†æ˜¯ `.dockerignore` æª”æ¡ˆï¼Œå°‡ä¸è¨±è¦è¢«è¼‰å…¥çš„æª”æ¡ˆå’Œè³‡æ–™å¤¾åˆ—å…¥ `.dockerignore` ä¾†æŒ‡ç¤º docker åœ¨å‰µå»º Image æ™‚å¿½ç•¥é€™äº›æª”æ¡ˆã€‚

### Commands merge åˆä½µæŒ‡ä»¤

```dockerfile
RUN apt-get update \
  && apt-get install -y git \
  && git clone <online-project> \
  && rm -rf /var/lib/apt/lists/* \
  && apt-get remove git -y
```
::image-with-note
åªéœ€è¦ç”¨ git æ‹‰ä¸€å€‹ä¹‹å¾Œéœ€è¦ç”¨çš„ Codeï¼Œé‚£å¯ä»¥åœ¨å¾Œé¢å°‡ git ç§»é™¤
::

ä¸Šé¢èªªé“åœ¨ Dockerfile ä¸­æ¯ä¸€è¡Œ `RUN` Â `COPY` Â `ADD` éƒ½æœƒç”Ÿæˆä¸€å€‹éšå±¤ï¼Œè€Œåœ¨ docker å‰µå»º Image æ™‚æœƒå¸¸å¸¸åŒ…æ‹¬è¨±å¤šå¾å®‰è£å„ç¨® package çš„æ­¥é©Ÿå’Œç·¨è­¯ä»£ç¢¼ç­‰ç­‰ï¼Œé€™äº›éƒ½æ˜¯éå¸¸èŠ±æ™‚é–“çš„æ­¥é©Ÿã€‚å¦‚æœèƒ½å°‡é€™é¡å‹çš„æŒ‡ä»¤åœ¨åŒä¸€å€‹ `RUN` è£¡é¢åˆä½µèµ·ä¾†çš„è©±ï¼Œé‚£ç”Ÿæˆçš„éšå±¤å°±åªæœƒæœ‰ä¸€å€‹äº†ã€‚èˆ‰ä¾‹ä¾†èªªåƒä¸Šé¢ä¸€æ¨£ç”¨ `&&` æŠŠæŒ‡ä»¤ä¸²èµ·ä¾†ï¼Œä¸ä½†å¯ä»¥æ¸›å°‘éšå±¤çš„æ•¸é‡ï¼Œé‚„èƒ½é é˜²åˆªé™¤çš„æª”æ¡ˆè¢«ç•™åœ¨éšå±¤å…§ã€‚

### Delete Caches åˆªé™¤å¿«å–

```bash
APK: ... && rm -rf /etc/apk/cache
YUM: ... && rm -rf /var/cache/yum
APT: ... && rm -rf /var/cache/apt
```

åœ¨å¤§å¤šæ•¸ Dockerfile ä¸­ï¼Œå®‰è£å„ç¨® package éƒ½æ˜¯å…ä¸äº†çš„æ­¥é©Ÿï¼Œåœ¨å®‰è£å¾Œå¦‚æœèƒ½åœ¨åŒä¸€å€‹ `RUN` æŒ‡ç¤ºä¸­åˆªé™¤å„ç¨® cachesï¼Œå°±å¯ä»¥é¿å…é€™å¯«å¤šé¤˜çš„è³‡æ–™äº†ã€‚ä¸Šé¢æ˜¯å„ç¨®å¸¸è¦‹çš„ package manager å­˜æ”¾å¿«å–çš„åœ°æ–¹ã€‚

::note
ğŸ’¡ Dive å·¥å…·çš„ efficiency åªæœƒæ‰¾å‡ºå„ç¨® ghost filesï¼ˆåœ¨ä¹‹å¾Œéšå±¤è¢«åˆªé™¤çš„æª”æ¡ˆï¼‰ï¼Œåƒé€™ç¨®è¢«éºå¿˜çš„æª”æ¡ˆæ˜¯ä¸æœƒè¢«æ‰¾å‡ºä¾†çš„ã€‚
::

### Squashing the image

::image-with-note
![squash å¾Œçš„ Image åªæœ‰Base Image çš„ 5.61MBï¼Œæ‰€ä»¥æŠŠæµªè²»çš„ç©ºé–“éƒ½ç§»é™¤äº†](/blog/container-docker/02/squash.png)
squash å¾Œçš„ Image åªæœ‰ Base Image çš„ 5.61MBï¼Œæ‰€ä»¥æŠŠæµªè²»çš„ç©ºé–“éƒ½ç§»é™¤äº†
::

ä½¿ç”¨ `--squash` æ˜¯ docker v1.13 ä»¥ä¸Šçš„ä¸€å€‹æ¸¬è©¦åŠŸèƒ½ Experimental Featureã€‚Docker æœƒåœ¨æœ€å¾Œå°‡æ‰€æœ‰çš„éšå±¤åˆç‚ºä¸€å€‹éšå±¤ (åœ–ä¸­çš„ merge sh)ã€‚å› ç‚ºåªæœ‰ä¸€å€‹éšå±¤ï¼Œé€™ç¢ºä¿å¾ŒæœŸåˆªé™¤çš„æª”æ¡ˆç¢ºå¯¦ä¸å­˜åœ¨æ–¼ Image ä¸­ã€‚

### Choose a Base Image

::image-with-note
![Common Linux distro and node distro example](/blog/container-docker/02/distroless.png)
Common Linux distro and node distro example
::

Base Image å°±æ˜¯ Dockerfile ä¸­ `FROM` æ‰€æŒ‡çš„ Imageï¼Œæ˜¯å‰µå»ºä¸€å€‹æ–° Image çš„åŸºåº•ã€‚ä¸Šåœ–ä¸­æœƒç™¼ç¾å„ç¨® Linux ç™¼è¡Œç‰ˆçš„ Image å¤§å°å·®è·å¾ˆå¤§ï¼Œç‰¹åˆ¥æ˜¯ alpine åªéœ€è¦ 5.61MB çš„å¤§å°ï¼Œå’Œå…¶ä»– Base Image ç›¸æ¯”çœŸçš„éå¸¸å°ã€‚ä¸€èˆ¬çš„ application å¦‚æœæ²’æœ‰ç‰¹å®šéœ€æ±‚è¦ä½¿ç”¨å„ç¨® Dependencyï¼Œå…¶å¯¦ä½¿ç”¨ alpine æ˜¯è¼ƒä½³çš„é¸æ“‡ã€‚

åœ–ä¸­ä¸‹é¢å…©è¡Œæ˜¯åŒ…å« `node.js` çš„ Imageã€‚è¨±å¤š Developer åœ¨æŒ‘é¸ Image æ™‚æœƒç›´æ¥åˆ° Dockerhub ä¸Šç›´æ¥éš¨ä¾¿æ‰¾å€‹æœ‰ `node.js` æˆ–å…¶ä»–ç·¨ç¨‹èªè¨€çš„ Image ä½¿ç”¨ï¼Œæ®Šä¸çŸ¥å…¶ä¸­çš„å·®åˆ¥éå¸¸å·¨å¤§ã€‚åƒæ˜¯åœ–ä¸­çš„ `node:10.16.3-buster` å°±æ˜¯ä¸€å€‹åœ¨ `debian@buster` ç™¼è¡Œç‰ˆä¸Šå®‰è£äº† `nodejs@10.16.3` çš„ Imageï¼Œå…¶å¤§å°å°‡é€²åˆ°äº† 1GBï¼ˆæƒ³åƒæ¯ä¸€æ¬¡è¦éƒ¨ç½²æ–°æ±è¥¿æ™‚é¦–å…ˆè¦ä¸‹è¼‰ 1GB å¤§å°çš„ Imageï¼‰ã€‚è€Œæœ€ä¸‹é¢çš„ [distroless](https://github.com/GoogleContainerTools/distroless?ref=blog.ewocker.com) Image é›–ç„¶ä¹Ÿæ˜¯åŸºæ–¼ `debian` ç™¼è¡Œç‰ˆï¼Œå»æŠŠä¸å¿…è¦çš„ Packages å…¨éƒ¨ç§»é™¤äº†ï¼Œåªç•™ä¸‹ `node.js` é‹è¡Œå¿…è¦çš„ç›¸é—œæ±è¥¿ã€‚

::note
ğŸ’¡ distroless æ˜¯ç”± Google ç¶­æŒçš„ä¸€å€‹ Projectï¼Œæ‰€ä»¥ä»–æ‰€ä½¿ç”¨çš„ Image Registry ä¸¦ä¸æ˜¯ dockerhub è€Œæ˜¯ GCRã€‚
::

### Scratch

`FROM scratch` åœ¨ Dockerfile ä¸­ä»£è¡¨å®Œå¾é›¶é–‹å§‹å‰µå»ºé€™å€‹ Imageã€‚é€™ç¨®æ–¹æ³•å‰µå»ºèµ·ä¾†çš„ Image å¤§å°ç„¡ç–‘æ˜¯æœ€å°ä¸”æœ€å„ªåŒ–çš„ã€‚ä½†é€™å€‹æ–¹æ³•ä¹Ÿç¨å¾®æ¯”è¼ƒæœ‰é›£åº¦ï¼Œæœ€å¸¸è¦‹çš„å°±æ˜¯ Image å…§åªéœ€è¦ä¸€å€‹ç°¡å–®çš„ binaryã€‚

ä¸Šé¢çš„ Asciinema å½±ç‰‡ç”¨æ–¼æ¼”ç¤ºä¸€æ®µ `Golang` ç·¨è­¯å‡ºçš„ binary `app` ï¼Œå‰µå»ºæ™‚ç”¨ `From scratch` ä¹Ÿå¯ä»¥é‹è¡Œï¼Œè€Œä¸” Image çš„å¤§å°å’Œ binary å¤§å°ä¸€æ¨¡ä¸€æ¨£ã€‚

### Multi-Stage Builds

```dockerfile
FROM golang:1.15.7-buster as builder
WORKDIR /go/src/github.com/ewocker/simple-website/
RUN go get -d -v golang.org/x/net/html  
COPY app.go .
RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o app .

FROM alpine:latest  
RUN apk --no-cache add ca-certificates
WORKDIR /root/
COPY --from=builder /go/src/github.com/ewocker/simple-website/app .
CMD ["./app"]
```

æˆ‘å€‹äººèªç‚º Multi-Stage Build æ˜¯å‰µå»º Image çš„æœ€å„ªè¾¦æ³•ï¼Œé€™ç¨®æ–¹å¼ä¸ä½†ç°¡å–®è€Œä¸”ä¹Ÿéå¸¸å®¹æ˜“ã€‚ç•¶ç„¶ä¸¦ä¸æ˜¯æ‰€æœ‰ Image éƒ½é©åˆé€™ç¨®æ–¹æ³•ï¼Œä½†å¤§å¤šæ•¸æ™‚å€™éƒ½èƒ½ä½¿ç”¨ Multi-Stage Build ä¾†æ“ä½œã€‚ç”¨ä¸Šé¢çš„ Dockerfile èˆ‰å€‹ä¾‹å­ï¼Œä¸Šé¢åˆ†åˆ¥æœ‰å…©å€‹ `From` æŒ‡ç¤ºï¼Œç¬¬ä¸€å€‹æˆ‘ç¨±å…¶ç‚º `builder` Image ä¸¦å°‡å…¶ç”¨æ–¼ç·¨è­¯è»Ÿé«”ï¼Œç¬¬äºŒå€‹å‰‡æ˜¯æˆ‘å¯¦éš›ä¸Šå‰µå»ºå‡ºçš„ Imageã€‚é€™æ¨£æˆ‘åœ¨æœ¬æ©Ÿä¸Šç„¡éœ€å®‰è£ Golang å°±å¯ä»¥ç·¨è­¯å‡º Golang çš„ Binary äº†ï¼Œè€Œä¸”é›–ç„¶ç·¨è­¯æ™‚é›–ç„¶æ˜¯ä½¿ç”¨ `golang:1.15.7-buster` ä½†å¯¦éš›ä¸Šæœ€å¾Œå‰µå»ºå‡ºçš„ Image å»æ˜¯ä½¿ç”¨ `alpine` çš„ã€‚ç°¡è€Œè¨€ä¹‹ Multi-Stage Build çš„å¥½è™•å°±æ˜¯å¯ä»¥ç„¡è¦–ç·¨è­¯æ™‚ç’°å¢ƒæ‰€éœ€çš„ Image å¤§å°ï¼Œç”šè‡³å¯ä»¥åœ¨å…¶ä¸­è·‘ Test å’Œåš Code Coverageï¼Œæœ€å¾Œåªè¦å°‡ç·¨è­¯å¥½çš„ç”¢ç‰©ç”¨ `COPY --from=` è¤‡è£½é€²æœ€å¾Œçš„ Image å³å¯ã€‚

### å…¶ä»–æ–¹æ³•

å„ªåŒ– Docker Image çš„æ–¹å¼æœ‰å¾ˆå¤šç¨®ï¼Œé™¤äº†ä¸Šè¿°çš„å¹¾ç¨®é è‡ªå·±çŸ¥è­˜çš„æ–¹æ³•å¤–ï¼Œä¹Ÿæœ‰è¨±å¤šé–‹æºçš„ Project å°ˆé–€æ–¼å„ªåŒ– Image çš„ï¼Œåƒæ˜¯ [Docker-slim](https://github.com/docker-slim/docker-slim?ref=blog.ewocker.com) ç­‰ä¹‹é¡çš„ã€‚é€™è£¡å› ç‚ºæ¶‰åŠåˆ°æ›´å¤šè¤‡é›œçš„æ¦‚å¿µåƒæ˜¯ Seccomp å’Œ AppArmor ç­‰ç­‰çš„è‡ªå‹•ç”Ÿæˆï¼Œæ‰€ä»¥æš«æ™‚ä¸å° docker-slim å¤šåšä»‹ç´¹ã€‚

---
