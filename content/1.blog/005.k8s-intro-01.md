---
layout: post
title: é–‹å§‹ä½¿ç”¨ Kubernetes (ä¸Š)
description: è¦é–‹å§‹äº†è§£ Kubernetesï¼Œé¦–å…ˆè¦å…ˆå‰µå»ºå‡ºä¸€å€‹å¯¦é«”ä¾†ç”¨æ–¼å­¸ç¿’ã€‚
series: Kubernetes
image:
  src: /blog/k8s-intro/01/hero.png
  alt: hero
head:
  meta:
    - name: keywords
      content: container, k8s, tech, cloud
    - name: robots
      content: index, follow
    - name: author
      content: å°è²“è²“å·¥ç¨‹å¸«
    - name: authorImage
      content: /common/siliconvalleykittycatengineer.jpeg
    - name: date
      content: Feb 10, 2021
    - name: read
      content: 7 min read
    - property: og:site_name
      content: çŸ½è°·è·¯ä¸Šé‡è¦‹ä½ 
    - property: og:type
      content: article
    - property: og:title
      content: é–‹å§‹ä½¿ç”¨ Kubernetes (ä¸Š)
    - property: og:description
      content: è¦é–‹å§‹äº†è§£ Kubernetesï¼Œé¦–å…ˆè¦å…ˆå‰µå»ºå‡ºä¸€å€‹å¯¦é«”ä¾†ç”¨æ–¼å­¸ç¿’ã€‚
    - property: og:url
      content: https://blog.ewocker.com/blog/k8s-intro-01
    - property: og:image
      content: https://blog.ewocker.com/blog/k8s-intro/01/hero.png
    - property: article:published_time
      content: 2021-02-10T00:00:00.000Z
    - property: article:modified_time
      content: 2023-03-20T00:00:00.000Z
    - property: article:publisher
      content: https://www.facebook.com/SiliconValleyKittyCatEngineer
    - property: article:author
      content: https://www.facebook.com/SiliconValleyKittyCatEngineer
    - property: og:image:height
      content: 536
    - property: og:image:width
      content: 750
    - name: twitter:card
      content: summary_large_image
    - name: twitter:title
      content: é–‹å§‹ä½¿ç”¨ Kubernetes (ä¸Š)
    - name: twitter:description
      content: è¦é–‹å§‹äº†è§£ Kubernetesï¼Œé¦–å…ˆè¦å…ˆå‰µå»ºå‡ºä¸€å€‹å¯¦é«”ä¾†ç”¨æ–¼å­¸ç¿’ã€‚
    - name: twitter:url
      content: https://blog.ewocker.com/blog/k8s-intro-01
    - name: twitter:image
      content: https://blog.ewocker.com/blog/k8s-intro/01/hero.png
    - name: twitter:label1
      content: Written by
    - name: twitter:data1
      content: å°è²“è²“å·¥ç¨‹å¸«
---

::note
ğŸ’¡ æˆ‘å€‹äººæ˜¯ä½¿ç”¨ macï¼Œæ‰€ä»¥ä¸‹é¢æœ‰é—œæ–¼å®‰è£çš„æƒ³é—œå…§å®¹æœƒä»¥ mac ç‚ºä¸»ã€‚  
å¹¾ä¹æ‰€æœ‰çš„å·¥å…·æˆ‘éƒ½æ˜¯ä½¿ç”¨ `asdf`ä¾†å®‰è£çš„ï¼Œéå¸¸æ¨è–¦ä½¿ç”¨ï¼

ğŸ’¡Â ä¸‹é¢ asciinema å½±ç‰‡è£¡çš„æ‰€æœ‰æŒ‡ä»¤ç›´æ¥ highlight ç”¨æ–¼è¤‡è£½è²¼ä¸Šï¼
::

---

## kubectl

::asciinema{id="389003"}
::

åœ¨é–‹å§‹ä½¿ç”¨ k8s ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦å®‰è£ `kubectl` ã€‚ `kubectl` æ˜¯ä¸€å€‹ k8s å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨æ–¼éƒ¨ç½²æ‡‰ç”¨ã€æª¢è¦–æ—¥èªŒã€åŠå„ç¨®å’Œ k8s cluster çš„äº’å‹•ã€‚æˆ‘å€‹äººå–œæ­¡ä½¿ç”¨ asdf ä¾†å®‰è£é€™é¡å·¥å…·ï¼Œä½†æ˜¯æ ¹æ“š[å®˜æ–¹æ–‡æª”](https://kubernetes.io/zh/docs/tasks/tools/install-kubectl/?ref=blog.ewocker.com)ä¾†å®‰è£ä¹Ÿæ˜¯éå¸¸å®¹æ˜“çš„ã€‚ä¸Šé¢æ˜¯ä¸€æ®µå¾ˆéš¨ä¾¿çš„ `asciinema`ï¼Œä¸»è¦åªæ˜¯æ¼”ç¤ºä¸€äº›éå¸¸ç°¡å–®çš„ `kubectl` ã€‚

---

## å‰µå»º Kubernetes Clusters

å¾é›¶é–‹å§‹å‰µå»ºä¸€å€‹ Kubernetes Cluster å¯¦éš›ä¸Šæ˜¯éå¸¸ç¹é›œçš„ä¸€ä»¶äº‹ï¼Œä½†åœ¨é–‹æºç¤¾ç¾¤çš„æ¨å‹•ä¸‹ï¼Œç¾åœ¨å·²ç¶“é€æ¼¸è®Šå¾—è¶Šä¾†è¶Šç°¡å–®äº†ã€‚é€™è£¡å°‡æœƒç°¡å–®ä»‹ç´¹å„å€‹å¸¸è¦‹çš„å‰µå»º Kubernetes æ–¹æ³•ã€‚

### Local

åœ¨æœ¬åœ°å‰µå»º k8s æ˜¯ç›¸è¼ƒèµ·ä¾†æ¯”è¼ƒç°¡å–®ä¸”å¿«é€Ÿçš„è¾¦æ³•ï¼Œéå¸¸é©åˆç”¨æ–¼å„ç¨®æ¸¬è©¦å’Œå­¸ç¿’ã€‚å¸¸è¦‹çš„å·¥å…·æœ‰ `minikube` å’Œ `kind`ã€‚

- #### [minikube](https://minikube.sigs.k8s.io/docs/?ref=blog.ewocker.com)
  ::asciinema{id="388793"}
  ::
  `minikube` æ˜¯ä¸€å€‹ç”¨æ–¼å‰µå»ºæœ¬åœ°å–®ä¸€é›†ç¾¤ k8s ç°¡å–®çš„å·¥å…·ï¼Œæ˜¯ä¸€å€‹åœ¨ VMä¸Šå‰µå»ºä¸€å€‹å–®ä¸€ç¯€é» node çš„ clusterã€‚é€™æ˜¯ç›®å‰æœ€å¸¸è¦‹ç”¨æ–¼åœ¨æœ¬åœ°ä¸Šæ¨¡æ“¬ä¸€å€‹ k8s cluster çš„å·¥å…·ã€‚
  å› ç‚ºæ˜¯åœ¨æœ¬åœ°ä¸Šå‰µå»ºçš„ k8sï¼Œæ‰€ä»¥æ•ˆèƒ½é‚„æ˜¯å—é™æ–¼è‡ªå·±é›»è…¦çš„è™•ç†å™¨åŠå…§å­˜å¤§å°ï¼Œä½†ä½œç‚ºå­¸ç¿’ç”¨å·¥å…·ï¼Œåœ¨å¤§å¤šæ•¸æƒ…æ³ä¸‹éƒ½æ˜¯è¶³å¤ çš„ã€‚
  `minikube` Â çš„å®‰è£æœ‰è¨±å¤šç¨®è¾¦æ³•ï¼Œå¯ä»¥[æ ¹æ“šå®˜æ–¹æ–‡æª”ä¾†å®‰è£](https://minikube.sigs.k8s.io/docs/start/?ref=blog.ewocker.com)ã€‚æˆ‘å€‹äººå–œæ­¡ä½¿ç”¨ `asdf` ä¾†å®‰è£é€™é¡å·¥å…·ï¼Œä¸Šé¢æ˜¯ä¸€æ®µç”¨ `minikube` å‰µå»º cluster çš„ç°¡å–® `asciinema` ã€‚

- #### [kind](https://kind.sigs.k8s.io/docs/user/quick-start/?ref=blog.ewocker.com)
  ::asciinema{id="389002"}
  ::
  `kind` æ˜¯ **K**ubernetes **in D**ocker çš„ç°¡å¯«ï¼Œæ˜¯ä½¿ç”¨ docker ç‚ºç¯€é»ä¾†å‰µå»º k8s çš„å·¥å…·ã€‚é–‹ç™¼ `kind` çš„åˆè¡·æ˜¯ç‚ºäº†æ¸¬è©¦ k8s æœ¬èº«ï¼Œä½†å› ç‚ºå…¶è¼•ä¾¿åŠç°¡å–®çš„ç‰¹ä¿¡ï¼Œè¿‘ä¾†æ…¢æ…¢è¢«ä½¿ç”¨æ–¼å„ç¨®ç°¡å–®çš„ local k8s service æ¸¬è©¦ç­‰ç­‰ã€‚
  `kind` çš„å®‰è£æœ‰è¨±å¤šç¨®è¾¦æ³•ï¼Œå¯ä»¥[æ ¹æ“šå®˜æ–¹æ–‡æª”ä¾†å®‰è£](https://kind.sigs.k8s.io/docs/user/quick-start/?ref=blog.ewocker.com#installation)ã€‚æˆ‘å€‹äººå–œæ­¡ä½¿ç”¨ `asdf` ä¾†å®‰è£é€™é¡å·¥å…·ï¼Œä¸Šé¢æ˜¯ä¸€æ®µç”¨ `kind` å‰µå»º cluster çš„ç°¡å–® `asciinema` ã€‚

### Cloud Managed

![k8s](/blog/k8s-intro/01/k8s.png)

å› ç‚º Kubernetes çš„å¿«é€Ÿæ™®åŠï¼Œå¸‚é¢ä¸Šå¹¾ä¹æ‰€æœ‰çš„é›²ä¾›æ‡‰å•†éƒ½æœ‰è‡ªå·±çš„ Managed Kubernetes æœå‹™ã€‚åƒæ˜¯ [GCP çš„ Google Kubernetes Engine (GKE)](https://cloud.google.com/kubernetes-engine?ref=blog.ewocker.com)ã€[AWS çš„ Elastic Kubernetes Service (EKS)](https://aws.amazon.com/eks/?ref=blog.ewocker.com)ã€[Azure çš„ Azure Kubernetes Service (AKS)](https://azure.microsoft.com/en-us/topic/what-is-kubernetes/?amp%3Bef_id=Cj0KCQiA0-6ABhDMARIsAFVdQv8GPBiBmtEtu_vx4GGIlWMn8amElgUiNIZ5pT1Rh_OWFYmL6bbOU0oaApghEALw_wcB%3AG%3As&%3BOCID=AID2100365_SEM_Cj0KCQiA0-6ABhDMARIsAFVdQv8GPBiBmtEtu_vx4GGIlWMn8amElgUiNIZ5pT1Rh_OWFYmL6bbOU0oaApghEALw_wcB%3AG%3As&ref=blog.ewocker.com)ï¼Œä»¥è‡³æ–¼ Digital Oceanã€Linodeã€é˜¿é‡Œå·´å·´ã€IBMã€RedHat ç­‰ç­‰ï¼ŒçœŸçš„æ˜¯ä¸€å¤§å †è€Œä¸”ç«¶çˆ­æ¿€çƒˆï¼  
Managed k8s å’Œä¸€èˆ¬è‡ªå·±å‰µå»ºå’Œç¶­è­·çš„ k8s ä¸»è¦çš„å·®åˆ¥å°±æ˜¯ï¼Œk8s ä¸­çš„ master nodes æ˜¯ç”±é›²ä¾›æ‡‰å•†ç®¡ç†çš„ã€‚ç°¡å–®ä¾†èªªå°±æ˜¯å„ç¨® control plane çš„ç¶­è­·å’Œé‹è¡Œéƒ½ç”±å» å•†æ‰¿åŒ…äº†ï¼Œæ‰€ä»¥å¯ä»¥çœä¸‹è¨±å¤šç¶­è­·å’Œå‡ç´šæ‰€éœ€çš„æ™‚é–“ã€‚  
å‰µå»ºé€™äº› managed k8s çš„æ–¹æ³•ä¸»è¦æ˜¯é€éå„å€‹é›²ä¾›æ‡‰å•†çš„ä½¿ç”¨è€…é é¢ (UI/Console) ä¾†å®Œæˆçš„ã€‚ä½†å› ç‚º GitOps ä»¥åŠ Infrastructure as Code æ¦‚å¿µçš„è¡ç”Ÿï¼Œæ„ˆä¾†æ„ˆå¤šç§‘æŠ€å¤§å» é–‹å§‹ä½¿ç”¨ [terraform](https://www.terraform.io/?ref=blog.ewocker.com) æˆ–æ˜¯ [pulumi](https://www.pulumi.com/?ref=blog.ewocker.com) ä¾†åœ¨å¹¾å¤§é›²ä¾›æ‡‰å•†å‰µå»º k8s äº†ã€‚

### Self-Managed

æœ‰è¨±å¤šå…¬å¸å› ç‚ºè³‡å®‰åŸå› æˆ–æ˜¯å„ç¨®å®¢è£½åŒ–åŸå› ï¼Œæœƒçµ„å»ºä¸€å€‹åœ˜å°ä¾†ç®¡ç†è‡ªå·±çš„ k8s clusters (åƒæ˜¯æˆ‘ç›®å‰å°±è·çš„å…¬å¸)ã€‚åƒé€™ç¨®æ™‚å€™å°±æœƒä½¿ç”¨åƒæ˜¯ `kops` ã€ `kube-spray` ã€ `kubeadm` ä¾†å‰µå»º clusterã€‚é€™äº›å·¥å…·ä¸»è¦ç”¨é€”ä¹Ÿæ˜¯åœ¨å„å¤§é›²ä¾›æ‡‰å•†æˆ– bare metal ä¸Šå‰µå»º k8sï¼Œä½†æ˜¯ä¸åƒ EKSã€GKEã€AKS ç­‰ç­‰ç”±é›²ä¾›æ‡‰å•†ç®¡ç†æ§åˆ¶çµ„ä»¶ Control Plane Componentï¼Œæ‰€æœ‰å‰µå»ºçš„ k8s éƒ½æ˜¯ç”±è‡ªå·±å…¨æ¬Šç®¡ç†çš„ã€‚

![kubeadm](/blog/k8s-intro/01/kubeadm.png)

[`kubeadm`](https://kubernetes.io/docs/reference/setup-tools/kubeadm/?ref=blog.ewocker.com) æ˜¯ä¸€å€‹ç”± Kubernetes å®˜æ–¹æ¨å‡ºçš„å·¥å…·ï¼Œå…¶ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ `kubeadm init` ä»¥åŠ `kubeadm join` ã€‚ç°¡å–®ä¾†èªªï¼Œå°±æ˜¯ç°¡åŒ–äº†**åˆå§‹åŒ– k8s çš„æ­¥é©Ÿ**å’Œ**å‰µå»ºæ–°ç¯€é» Node çš„æ­¥é©Ÿ**ã€‚`kubeadm` æ¯”è¼ƒé©ç”¨æ–¼åœ¨ bare metal æ™‚ä½¿ç”¨ï¼Œå› ç‚ºå¦‚æœæ˜¯ä½¿ç”¨é›²ä¾›æ‡‰å•†çš„è©± `kops` å’Œ `kube-spray` éƒ½æƒ³å«ç°¡å–®ã€‚æˆ‘å€‹äººèªç‚º `kubeadm` ä¹Ÿå¾ˆé©åˆç”¨æ–¼å­¸ç¿’äº†è§£ k8s cluster çš„å‰µå»ºæ­¥é©Ÿä»¥åŠç´°ç¯€ã€‚

![kops](/blog/k8s-intro/01/kops.png)

[`kops`](https://github.com/kubernetes/kops?ref=blog.ewocker.com) æ˜¯ **K**ubernetes **Op**eration**s** çš„è‹±æ–‡ç¸®å¯«ï¼Œæ˜¯ä¸€å€‹éå¸¸å¥½ç”¨çš„ k8s ç®¡ç†å·¥å…·ã€‚å…¶æœ‰è¨±å¤šçš„ configuration é¸é …è®“ç®¡ç† k8s è®Šå¾—éå¸¸çš„ç°¡å–®ï¼Œä¸¦ä¸”æ¯ä¸€å€‹æ–°çš„ç‰ˆæœ¬éƒ½éƒ½æœ‰è¨±å¤šè³‡å®‰æ–¹é¢çš„è€ƒé‡ï¼Œè€Œä¸”èƒŒå¾Œé–‹æºåœ˜éšŠçš„æˆå“¡çœŸçš„éƒ½éå¸¸å¼· (å› ç‚ºå…¶ä¸­æœ‰æˆ‘å€‘å…¬å¸çš„ä¸€å€‹å¤§ç¥)ï¼

![kubespray](/blog/k8s-intro/01/kubespray.png)

[`kube-spray`](https://github.com/kubernetes-sigs/kubespray?ref=blog.ewocker.com) æ˜¯ä¸€å€‹ Kubernetes Incubator ä¸­çš„é …ç›®ï¼Œä¸»è¦æ˜¯é€é Ansible Playbook ä¾†å®Œæˆå®šç¾©ç³»çµ±åŠ k8s çš„éƒ¨ç½²ä»»å‹™ã€‚èˆ‡ `kops` ä¸åŒçš„æ˜¯ï¼Œ`kops` å’Œé›²ä¾›æ‡‰å•†æœ‰æœ‰è¼ƒå¤§çš„ç¶å®šï¼Œä½† `kube-spray` å› ç‚ºæ˜¯ä½¿ç”¨ Ansible ä¾†å®Œæˆå„é …éƒ¨ç½²å·¥ä½œï¼Œæ‰€æœ‰åœ¨é‹è¡Œå¹³å°ä¸Šæœ‰è¼ƒå¤šçš„é¸æ“‡å’Œå®¢è£½åŒ–é¸æ“‡ã€‚ä½†ä½¿ç”¨é›£åº¦ç¢ºå¯¦æ˜¯æ¯” `kops` è¦é«˜ä¸Šä¸€äº›çš„ã€‚

---

## å…¶ä»–çš„ k8s ç·´ç¿’ç®¡é“

é™¤äº†è‡ªå·±å‰µå»ºè‡ªå·±çš„ k8s ä¾†èµ·æ­¥ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥é¸æ“‡é€éä¸€äº›é¡ä¼¼æ–¼æ¨¡æ“¬çš„ç¶²ç«™ä¾†ç·´ç¿’ã€‚åƒæ˜¯ç”± O'Reilly æä¾›çš„ [Katacoda çš„ k8s playground](https://www.katacoda.com/courses/kubernetes?ref=blog.ewocker.com)ï¼Œæœ‰å„ç¨®ä¸åŒçš„æƒ…å¢ƒè®“äººç·´ç¿’å„ç¨®ç°¡å–®çš„ç‹€æ³ï¼Œæˆ–æ˜¯ [Play With Kubernetes](https://labs.play-with-k8s.com/?ref=blog.ewocker.com)ï¼Œä¸€å€‹å¾é›¶é–‹å§‹ç·´ç¿’å‰µå»º k8s çš„ç¶²ç«™ã€‚

---

## ç¸½çµ

ä¸Šé¢æä¾›å„ç¨®å¸¸è¦‹é–‹å§‹ä½¿ç”¨ k8s çš„æ–¹å¼ã€‚é›–ç„¶ç›´æ¥åœ¨é›²ä¾›æ‡‰å•†ä¸Šå‰µå»ºä¸€å€‹ k8s cluster æ˜¯æœ€è²¼è¿‘æ¥­ç•Œéœ€æ±‚çš„æ–¹æ³•ï¼Œä½†ä¸€èˆ¬ä¾†èªªå¦‚æœæ˜¯ç´”å±¬ç·´ç¿’ç”¨é€”ä¸¦ä¸æ¨è–¦é€™æ¨£åšï¼Œå› ç‚ºé™¤äº†è¦å°å„å€‹é›²ä¾›æ‡‰å•†æœ‰åŸºæœ¬çš„ç­è§£ä¹‹å¤–é‚„è¦è€ƒé‡åˆ°åƒ¹æ ¼ã€‚æˆ‘å€‹äººæœ€æ¨è–¦çš„å°±æ˜¯ä½¿ç”¨ `minikube` æˆ–æ˜¯ `kind` åœ¨æœ¬åœ°å‰µå»ºï¼Œé¦–å…ˆæ˜¯é›£åº¦è¼ƒä½ä¸”æ²’æœ‰å¤ªå¤šçš„é–€æª»ï¼Œå†ä¾†å°±æ˜¯ç›¸è¼ƒä½¿ç”¨ katacoda é€™é¡ç¶²ç«™æ¯”è¼ƒæœ‰çœŸå¯¦æ„Ÿï¼Œè€Œä¸”å› ç‚ºæ˜¯è‡ªå·±çš„ clusterï¼Œæ‰€ä»¥æƒ³æ€éº¼å˜—è©¦éƒ½æ²’å•é¡Œã€‚  
æ¨è–¦æƒ³è¦é–‹å§‹å­¸ç¿’ k8s çš„è®€è€…å¯ä»¥è‡ªå·±è©¦è‘—ä½¿ç”¨ `minikube` ä¾†åœ¨æœ¬åœ°å‰µå»ºä¸€å€‹ clusterï¼Œä»¥ä¾¿æ–¼å¾ŒçºŒæ•™å­¸æ–‡ç« ä¸­çš„å¯¦ä½œå…§å®¹ã€‚

::note
ğŸ’¡ä½¿ç”¨ `kind` ä¹Ÿå¯ä»¥ï¼Œé€™è£¡æ¨è–¦ `minikube` æ˜¯å› ç‚ºæ’°å¯«çš„ç•¶ä¸‹ `kind` é‚„æ²’æœ‰ GAã€‚
::

---
