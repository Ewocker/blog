---
layout: post
title: Docker å…¥é–€å¯¦ä½œ
description: é–‹å§‹ä¹‹å‰å¦‚æœå° Container å’Œ Docker é‚„ä¸å¤ªäº†è§£ï¼Œæ¨è–¦å…ˆé–±è®€å‰é¢çš„æ–‡ç« ã€‚æœ¬ç¯‡å°‡æœƒç°¡å–®çš„è¬›è¿° docker å¸¸è¦‹çš„é–‹ç™¼æµç¨‹ï¼Œä¸»è¦æ˜¯çµ¦å° docker é‚„ä¸å¤ªäº†è§£çš„è®€è€…åƒè€ƒã€‚
series: Container Technology
image:
  src: hero.png
  alt: hero
  width: 750
  height: 536
keywords:
  - container
  - docker
  - tech
  - cloud
head:
  meta:
    - name: author
      content: å°è²“è²“å·¥ç¨‹å¸«
    - name: read
      content: 5 min read
    - property: article:published_time
      content: 2021-01-15T00:00:00.000Z
    - property: article:modified_time
      content: 2023-03-20T00:00:00.000Z
---

::note
é–‹å§‹ä¹‹å‰å¦‚æœå° Container å’Œ Docker é‚„ä¸å¤ªäº†è§£ï¼Œæ¨è–¦å…ˆé–±è®€å‰é¢çš„æ–‡ç«  [Container åŸºæœ¬æ¦‚å¿µä»‹ç´¹](https://blog.ewocker.com/blog/container-docker/00)ï¼
::

## å®‰è£æŒ‡å— Installation Guide

åœ¨é–‹å§‹ä¹‹å‰é¦–å…ˆéœ€è¦å®‰è£ Dockerã€‚åªè¦æŒ‰è‘—æ–‡æª”èµ°ï¼Œå®‰è£ Docker å…¶å¯¦éå¸¸ç°¡å–®ã€‚å¦‚æœæ˜¯ Linux OS çš„è©±æˆ‘å€‹äººæ¨è–¦ [Digital Ocean çš„æ–‡æª”](https://www.digitalocean.com/community/tutorials?q=install+docker&ref=blog.ewocker.com)ï¼Œå¯«å¾—å¾ˆè©³ç´°è€Œä¸”å„å¼ç‰ˆæœ¬éƒ½æœ‰ã€‚

---

## é–‹ç™¼æµç¨‹

![](flow.png)

åœ¨ä½¿ç”¨ Docker æ™‚ï¼Œæœ€å¸¸è¦‹çš„æŒ‡ä»¤ Command æœ‰ä»¥ä¸‹å¹¾ç¨®ï¼š
- `docker build`
- å‰µå»º Image- `docker pull/push <image>`
- å°å€‰åº« Registry æ¨é€å’ŒæŠ“å– Image- `docker run <image>` - æ ¹æ“š Image é‹è¡Œ Container

è€Œå‰µå»º Image å‰‡æ˜¯éœ€è¦æ’°å¯«ä¸€å€‹ Dockerfile æ–‡æª”ã€‚å¯« Dockerfile æœ‰å¾ˆå¤š Best Practicesï¼Œæ¯”å¦‚æ‰€å»ºå‡ºçš„ Image å¤§å°ã€ä»¥åŠ Security ç›¸é—œç­‰ç­‰ã€‚é€™è£¡æˆ‘å€‘æš«æ™‚å…ˆä¸è€ƒæ…®å¤ªå¤šï¼Œä»¥å‰µå»ºç°¡å–®çš„ Image ç‚ºé‡é»ã€‚

::note
ğŸ’¡ Â ä¸‹é¢ asciinema å½±ç‰‡è£¡çš„æ‰€æœ‰æŒ‡ä»¤ç›´æ¥ highlight ç”¨æ–¼è¤‡è£½è²¼ä¸Šå–”ï¼
::

ä¸‹é¢æˆ‘å€‘æœƒå‰µå»ºä¸€å€‹ç°¡æ˜“çš„è»Ÿé«”ä¸¦åŒ…è£æˆ Containerï¼Œè·‘ä¸€äº›å¸¸ç”¨çš„é™¤éŒ¯æŒ‡ä»¤ï¼Œç„¶å¾Œä¸Šå‚³è‡³ Registry ç­‰ç­‰ã€‚

### å‰µå»ºè»Ÿé«”

é¦–å…ˆæˆ‘å€‘ä¾†å¯«ä¸€å€‹ç°¡å–®çš„ `count.sh`ï¼Œå®ƒçš„åŠŸç”¨æ˜¯å¾ä¸€æ•¸åˆ°ä¸‰ã€‚å¦‚æœå° Shell èªæ³•ä¸å¤ªç†Ÿæ‚‰ä¹Ÿä¸éœ€è¦æ“”å¿ƒï¼Œé€™åªæ˜¯æ¼”ç¤ºç”¨çš„è€Œå·²ã€‚

```bash
#!/bin/sh

# Purpose of this script is to count to 3

i="1"

while [ $i -lt 4 ]
do
  echo $i
  i=$(($i + 1))
  sleep 1
done
```

::asciinema{id="381988"}
::

### å‰µå»º Image

æ¥ä¸‹ä¾†æˆ‘å€‘å°‡å¯«å¥½çš„ application åŒ…è£æˆæ˜ åƒæª” Imageã€‚ç°¡å–®è§£é‡‹ä¸€ä¸‹:

```dockerfile
FROM alpine:3

COPY count.sh .

CMD ["./count.sh"]
```

- `FROM alpine:3`  
  æ˜¯æŒ‡ä½¿ç”¨ Linux ç™¼è¡Œç‰ˆ alpine çš„æœ€æ–°ç‰ˆæœ¬ 3ï¼Œé€™æœƒå¾ Docker Hub ä¸­æŠ“å–å®˜æ–¹ä¸Šå‚³å¥½çš„ Linux alpine ç™¼è¡Œç‰ˆä¸‹ä¾†ï¼Œç›¸ç•¶æ–¼é‹è¡Œäº† `docker pull alpine:3` ï¼Œå¦‚æœåœ¨æœ¬åº•å·²æœ‰ `alpine:3` çš„ Image å‰‡æœƒç›´æ¥å–ç”¨ã€‚  
  é€šå¸¸æˆ‘å€‘æœƒç¨±æ­¤ç‚º **_Base Image_**ã€‚
- `COPY count.sh`  
  æ˜¯æŒ‡å°‡ä¸Šé¢å¯«å¥½çš„ `count.sh` è¤‡è£½é€²å…¥ Image è£¡é¢ã€‚
- `CMD ["./count.sh"]`  
  å‰‡æ˜¯åªé»˜èªé‹è¡Œ `./count.sh` ã€‚

::asciinema{id="382209"}
::

é€™è£¡ä½¿ç”¨äº† `docker build -t ewocker/count .` ä¾†å‰µå»º Imageï¼Œç°¡å–®è§£é‡‹ä¸€ä¸‹ï¼š
- `-t ewocker/count .`
  `-t => --tag` æ˜¯æŒ‡å‘½å Image çš„å…¨åç‚º `ewocker/count` ï¼Œ `ewocker` æ˜¯æˆ‘åœ¨ Docker Hub ä¸Šé¢çš„ Repository IDï¼Œ `count` å‰‡æ˜¯ Image çš„åå­—ã€‚æœ€å¾Œçš„ `.` å‰‡æ˜¯æŒ‡åœ¨ç›®å‰è·¯å¾‘ `~/Desktop/docker` é‹è¡ŒæŒ‡ä»¤ã€‚
- æœ€å¾Œå‰µå»ºå‡ºçš„ Image å¯«åˆ° `Successfully tagged ewocker/count:latest`  
  ä»£è¡¨ Image çš„å…¨å tag ç‚º `ewocker/count:latest` ï¼Œå› ç‚ºåœ¨å‰µå»ºæ™‚æ²’æœ‰çµ¦äºˆç‰ˆæœ¬ï¼Œæ‰€ä»¥é»˜èªæœƒåœ¨å¾Œé¢åŠ ä¸Š `latest`ã€‚ç°¡å–®ä¾†èªª Image tag çš„çµ„æˆæ˜¯ `<registry path>/<name>:<version>`ã€‚

### é‹è¡Œ Container

åœ¨å‰µå»ºå¥½ Image å¾Œæˆ‘å€‘å¯ä»¥ç°¡æ˜“çš„é‹è¡Œ Containerã€‚

é€™è£¡ä½¿ç”¨äº†å…©ç¨®æ–¹å¼ä¾†é‹è¡Œ Containerï¼Œç°¡å–®è§£é‡‹ä¸€ä¸‹ï¼š
- `docker run --rm ewocker/count`
  `--rm` æ˜¯æŒ‡é‹è¡ŒçµæŸå¾Œå°‡ container ç§»é™¤ã€‚`ewocker/count` å‰‡æ˜¯æŒ‡æ ¹æ“šé€™å€‹ Image ä¾†é‹è¡Œ containerã€‚
- `docker run --rm -it ewocker/count /bin/sh`  
  é€™æ˜¯æ¯”è¼ƒå¸¸è¦‹çš„ debug ç”¨æŒ‡ä»¤ï¼Œ`-it` åˆ†åˆ¥æ˜¯ `-i => --interactive` å’Œ `-t => --tty` ã€‚  
  ç°¡å–®çš„èªªå°±æ˜¯åœ¨é‹è¡Œ container å¾Œé€£æ¥ä¸€å€‹ STDIN Shellï¼Œä¸¦ç”¨ `/bin/sh` è¦†å¯«é»˜èªçš„ `./count.sh` ã€‚  
  åœ¨é‹è¡Œå¾Œæœ¬ä¾†æ‡‰è©²æ•¸å®Œ `1->3` å°±çµæŸçš„ container å› ç‚ºä¸¦æ²’æœ‰é‹è¡Œé»˜èªçš„ shellscript è€Œæ˜¯é‹è¡Œäº†ä¸€å€‹ `shell` ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ Container è£¡é¢é‹è¡Œä»»ä½•æŒ‡ä»¤ç”¨æ–¼ debugã€‚ç°¡å–®ä¾†èªªå°±æ˜¯é€²å…¥åˆ°ä¸€å€‹ Container è£¡é¢ï¼Œåœ¨ä¸Šé¢å½±ç‰‡è£¡æˆ‘å€‘åœ¨é€²å…¥åˆ° container è£¡é¢å¾Œé‹è¡Œ `ls` ç™¼ç¾ output å’Œåœ¨æœ¬åœ°é‹è¡Œæ™‚å®Œå…¨ä¸åŒï¼Œå› ç‚ºæˆ‘å€‘æ˜¯åœ¨ä¸€å€‹é‹è¡Œä¸­çš„ linux alpine container ä¸­é‹è¡Œçš„æŒ‡ä»¤ã€‚

### ä½¿ç”¨ Registry

æœ€å¾Œæˆ‘å€‘æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ registryã€‚

é€™è£¡ä¸»è¦ä½¿ç”¨ `docker push ewocker/count` å’Œ `docker pull ewocker/count` ï¼š
- `docker push ewocker/count`  
  é¦–å…ˆæˆ‘å€‘å°‡ Image `ewocker/count:latest` ä¸Šå‚³è‡³ registryï¼Œåœ¨é‚£ä¹‹å‰æˆ‘å€‘å¿…é ˆè¦æœ‰ä¸€å€‹ Docker Hub çš„å¸³è™Ÿï¼Œå¦‚æœé‚„æ²’æœ‰å‰µè¾¦å¯ä»¥åœ¨é€™å€‹ [link](https://hub.docker.com/?ref=blog.ewocker.com) ä¸Šå…ˆå‰µè¾¦ä¸€å€‹ã€‚æœ‰äº†å¸³è™Ÿå¾Œè¦å…ˆé‹è¡Œ `docker login` ä¾†ç™»å…¥å¸³è™Ÿã€‚  
  åœ¨å½±ç‰‡ä¸­æˆ‘å€‘çœ‹åˆ° `The push refers to repository [docker.io/ewocker/count]` ã€‚åœ¨ä½¿ç”¨ `docker push` æ™‚é»˜èª registry æœƒä½¿ç”¨ Docker Hub `docker.io` ï¼Œè€Œå…¨ repository path å‰‡è®Šæˆ `docker.io/ewocker/count`ã€‚
- `docker pull ewocker/count`  
  åœ¨ä¸Šå‚³ä¹‹å¾Œï¼Œæˆ‘å€‘å…ˆç”¨ `docker image rm ewocker/count` å°‡æœ¬åœ°çš„ Image ç§»é™¤ä¾†æ¨¡æ“¬åœ¨å¦ä¸€å°é›»è…¦ä¸ŠåŸå…ˆä¸¦æ²’æœ‰ Image çš„æƒ…æ³ã€‚æ¥è‘—é‹è¡Œ pull ä¾†å°‡ Image æŠ“å–ä¸‹ä¾†ï¼Œè€Œåœ¨é‚£ä¹‹å¾Œé‹è¡Œ `docker image ls | grep ewocker/count` ä¾†è¡¨ç¤º Image å·²ç¶“è¢«æŠ“å–åˆ°æœ¬åœ°äº†ã€‚

---

## çµèª

æœ¬ç¯‡éå¸¸ç°¡å–®çš„è¬›è¿°äº† docker å¸¸è¦‹çš„é–‹ç™¼æµç¨‹ï¼Œèªªåˆ° container é›–ç„¶ä¸æœ‰ dockerï¼Œä½†æœ€å¸¸è¦‹å’Œå¿…é ˆçŸ¥é“çš„ç›®å‰é‚„æ˜¯é docker è«å±¬ã€‚

---
